# *Detail Design: Temperature and Humidity Control*
## **Team 2 - Greenhouse Project**
### *Team Members: Jared Hooker and Noah Jones*

## **Function of the Subsystem:**
The function of this subsystem is to measure the temperature and the humidity levels in the greenhouse. The DHT20 sensor will measure both values, then relay the information to the Arduino Nano 33 IoT device. 

## **Constraints:**

- **Arduino Nano 33 IoT**
  1. The communication between the Arduino and the PLC must be wireless. This will allow for the system to be scalable, meaning that the greenhouse can be expanded to add more zones if needed.
  2. The data transfer from the sensors to the Arduino must be below 5 seconds to allow an adequate amount of time before the Arduino returns to its sleep mode.
  3. The Arduino shall be able to wirelessly transmit the data to the gateway Arduino Nano 33 IoT and PLC in a cost effective way.

- **DHT20 Temperature & Humidity Sensor**
  1. The sensor shall have 2.5-5.5 V to operate correctly.
  2. Sensor uses 3.2mW when on, and 0 W when in sleep mode.
  3. Temperature range of 0-50°C (32-122°F) and humidity range of 20-90%.
  4. Sampling period of greater than or equal to 2 seconds, so it is set to be 10 seconds to allow for extra time.

## **Buildable Schematic:**
![Buildable Schematic Temperature & Humidity Monitoring](https://github.com/RealityHertz/Greenhouse-Project/blob/main/Documentation/Images/CADTemperature%26HumidityDrawing.jpg)
## **Analysis:**
- **Arduino Nano 33 IoT**
  1. The power supply will be four AA batteries. Each battery contains 1.1-1.5 volts, which will give the Arduino the required 5 volts.
  2. The Arduino will turn on for 10 seconds once every 5 minutes. This can be done using functions from the Arduino-Libraries Github [1]. By instructing the Arduino to go into sleep mode using the LowPower.sleep() function, the desired time range can be achieved.
  3. Using Bluetooth Low Energy (BLE) allows for a cost efficient manner to transmit data throughout the greenhouse. A disadvantage of BLE is the decreased distance that information can be transmitted. Most BLE devices can trasmit/receive data at a max rate of 50 meters [2]. However, the distance between the Arduino and the PLC will only be 15 feet, or 4.57 meters.
 
- **DHT20 Temperature & Humidity Sensor**
    1. The DHT20 temperature and humidity sensor is powered by the Arduino. An output voltage of 5 V is sent to the DHT20 via the Arduino.
    2. The DHT20 does not consume much power from the batteries. The amount of power from the DHT20 and Arduino are as follows:
       - AA batteries supply 1.5V and 3500mAh each. P = (1.5V*3500mAh) * 4 batteries = 21Wh
       - Arduino uses 5V and 28mA while in the "on" mode. P = (5V * 28mA) * (120s/3600s) = 4.67mWh.
       - Sensor uses 3.2mW while on, and 0.8μW in the "dormant" state. P = (3.2mW) * (120s/3600s) + (0.8μW) * (3480s/3600s) = 0.107mWh
       - Total power consumed: P = 4.67mWh + 0.107mWh = 4.777mWh. 21Wh/4.777mWh = 4,396.1 hours or 6.11 months.
    3. The temperature and humidity ranges are ideal for greenhouses. When speaking to the greenhouse coordinator, the temperature ranges from 60-85°, and humidity ranges from 50-80% in this specific greenhouse. The goal for this subsystem is to send an alert to the PLC to notify the manager when the temperature or humidity is out of these specific ranges. 
    4. The DHT20 must be on for at least 2 seconds in order to detect the temperature and humidity, as well as send the data to the Arduino. By leaving the Arduino on for 10 seconds, the sensor will have a sufficient amount of time to measure and transmit the data.
    5. The sensor will communicate via I2C using SDA and SCL lines. The datasheet mentions that there are two SDA lines, one controlled by the sensor and the other by the MCU, which is the Arduino Nano 33 IoT. During communication, both the sensor and the MCU will have control over the SDA line at different times, depending on the direction of communication. The start and stop transmission states in the I2C protocol are as following. When initiating a transmission sequence, the Arduino will generate the start condition by pulling the SDA line low while SCL is high. This signals the beginning of a communication session. Similarly, the stop condition is generated by the Arduino by releasing the SDA line, allowing it to go high while SCL is high, indicating the end of communication. For the timing of the SCL and SDA, the falling edge of SCL will trigger the SDA to read. This means that data on the SDA line should be stable and valid by the time the falling edge of SCL occurs, indicating a point in time when the data can be read. Overall, SDA and SCL work together in the I2C protocol to facilitate communication between the sensor and the Arduino. SCL provides the clock signal that synchronizes data transfer, while SDA carries the actual data being transmitted or received. [4]

 - **Communication for DHT20**
     1. The DHT20 follows inter-integrated circuit (I2C) protocol to communicate with the Arduino 33 IoT. I2C is supported on all Arduino boards. [3]
    
## **Bill of Materials:**
|Brand/Manufacturer|Part Name|Supplier|Part/Model Number|Quantity|Individual Price|Total|
|----|-----------|-----------|------------|--------|----------------|-----|
|Adafruit|Temperature and Humidity Sensor|Adafruit|DHT20|2|$4.50|$9.00|
|Arduino|Bluetooth Board|Arduino|Nano 33 IOT|1|$26.30|$26.30|
|LAMPVPATH|4 AA Battery Holder|Amazon|B07L9M6VZK|1|$7.49|$7.49|
|Duracell|AA Batteries|Amazon|DURMN1500B10Z|1|$8.79|$8.79|


## **References:**
[1]  “Arduino Low Power - Arduino Reference,” www.arduino.cc, Nov. 08, 2023). ‌https://www.arduino.cc/reference/en/libraries/arduino-low-power/

[2] “Advantages of BLE (Bluetooth Low Energy) | disadvantages of BLE (Bluetooth Low Energy),” www.rfwireless-world.com. https://www.rfwireless-world.com/Terminology/Advantages-and-Disadvantages-of-BLE-Bluetooth-Low-Energy.html

[3] Arduino.cc, 2024. https://docs.arduino.cc/learn/communication/wire/

[4] SparkFun Electronics, "DHT20 Sensor Datasheet," SparkFun Electronics, https://cdn.sparkfun.com/assets/8/a/1/5/0/DHT20.pdf
